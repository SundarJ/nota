<!DOCTYPE html>
<html lang="en">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> of nota </title>

  <link rel="stylesheet" href="use/sheets/base.css">
  
  <script src="use/scripts/util.js"></script>
  <script src="https://rawgit.com/mariocasciaro/object-path/master/index.js"></script>
  
  <link rel="import" href="use/components/nota-list.html">
  <link rel="import" href="use/components/nota-editor.html">
  
  <main></main>

  <template>
      <main>
        <router-view :items="notae"></router-view>
      
        <nota-editor :item="nota"></nota-editor>
      </main>
  </template>

  <script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.18/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/0.7.10/vue-router.js"></script>
  <script src="https://cdn.rawgit.com/simplesmiler/vue-focus/0.1.1/dist/vue-focus.min.js"></script>

  <script>
     'use strict';
    
    (function({ document, Vue, VueRouter, objectPath }) {

      Vue.config.debug = true
      Vue.directive( 'focus' , VueFocus.focus )
      
      
      let NotaEditor, NotaList
      
      Vue.component( 'nota-editor' , 
        NotaEditor = objectPath.get(window, 'nota.components.NotaEditor')
      )
      
      NotaList = Vue.extend( objectPath.get(window, 'nota.components.NotaList') )


      let $notae;

      // try {
        // notae = JSON.parse( localStorage.notae )
      // }  catch(er) {
        $notae = [
          { $id: u.uid() , $folder: '*' , title: 'The Silmarillion'   , content: [ 'duup' , 'lex' ] },
          { $id: u.uid() , $folder: '*' , title: '不思議の国のアリス' , content: [ 'hely' ] },
          { $id: u.uid() , $folder: '*' , title: 'Warning!!'  , content: [ 'tropic' ] },
          { $id: u.uid() , $folder: 'other' , title: 'Don\'t Panic' , content: [ 'yuna' ] },
          { $id: u.uid() , $folder: 'other/else' , title: 'Sometimes' , content: [ 'yuna' ] },
          { $id: u.uid() , $folder: 'other/else/another' , title: '1' , content: [ 'yuna' ] },
        ]
      // }


      const App = Vue.extend({
        template: document.querySelector('template').innerHTML,
        
        data: () => ({ Notae: $notae }),

        events: {
          edit({ $id, title, content }) {
            
            /*this.notae.forEach((nota, idx) => {
              if ( nota.$id === $id ) {
                this.notae[idx].title = title
                this.notae[idx].content = content
              }
            })*/
            
            console.log($id, title, content)
          },
        },
        
        computed: {
          nota() {

            return this.notae.find(
              nota => nota.$slug === this.$route.params.slug
            )
          },
          
          notae() {
            return this.Notae.map(Nota => {
              Nota.$slug = u.slugify(Nota.title)
              
              return Nota
            })
          },
        },
        
        name: 'nota',
      })

      let $root = '.'
      if ( location.pathname.slice(1) ) $root = location.pathname

      const router = window.router = new VueRouter({ history: true , root: $root })
      
      router.map({
        '/*folder': {
          name: 'nota',
          component: NotaList,
        },
        
        '/*folder/:slug': {
          name: 'nota',
          component: NotaList,
        },
      })
      
      router.alias({
        '/': '/*'
      })
      
      router.start(App, 'main')

      // window.onbeforeunload = () => localStorage.notae = JSON.stringify( vm.$data.notae )

    })(this)
  </script>

</html>
