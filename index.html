<!DOCTYPE html>
<html lang="en">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> of nota </title>

  <link rel="stylesheet" href="use/sheets/base.css">
  
  <script src="use/scripts/util.js"></script>
  <script src="https://rawgit.com/mariocasciaro/object-path/master/index.js"></script>
  
  <link rel="import" href="use/components/nota-list.html">
  <link rel="import" href="use/components/nota-editor.html">
  
  <main></main>

  <template>
      <main>
        <router-view :items="notae"></router-view>
      
        <nota-editor :item="nota"></nota-editor>
      </main>
  </template>

  <script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.18/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/0.7.10/vue-router.js"></script>
  <script src="https://cdn.rawgit.com/simplesmiler/vue-focus/0.1.1/dist/vue-focus.min.js"></script>

  <script>
    (function({ document, Vue, VueRouter, objectPath }) {

      'use strict'

      Vue.config.debug = true
      Vue.directive( 'focus' , VueFocus.focus )
      
      
      let NotaEditor, NotaList
      
      Vue.component( 'nota-editor' , 
        NotaEditor = objectPath.get(window, 'nota.components.NotaEditor')
      )
      
      NotaList = Vue.extend( objectPath.get(window, 'nota.components.NotaList') )


      let $notae;

      // try {
        // notae = JSON.parse( localStorage.notae )
      // }  catch(er) {
        $notae = [
          { $id: u.uid() , title: 'An'   , content: [ 'duup' , 'lex' ] },
          { $id: u.uid() , title: 'note' , content: [ 'hely' ] },
          { $id: u.uid() , title: 'for'  , content: [ 'tropic' ] },
          { $id: u.uid() , title: 'thee' , content: [ 'yuna' ] },
        ]
      // }


      const App = Vue.extend({
        template: document.querySelector('template').innerHTML,

        data: function() {
          
          return {
            notae: $notae,
          }
        },

        events: {
          edit({ $id, title, content }) {
            
            this.notae.forEach((nota, idx) => {
              if ( nota.$id === $id ) {
                this.notae[idx].title = title
                this.notae[idx].content = content
              }
            })
          },
        },
        
        computed: {
          nota() {
            
            return this.notae.find(
              nota => nota.$id === this.$route.params.id
            )
          }
        },
        
        name: 'nota',
      })


      const router = new VueRouter({ history: true  , root: location.pathname })
      
      router.map({
        '/': {
          component: NotaList,
        },
        
        '/n/:id': {
          name: 'nota',
          component: NotaList,
        },
      })
      
      router.start(App, 'main')

      // window.onbeforeunload = () => localStorage.notae = JSON.stringify( vm.$data.notae )

    })(this)
  </script>

</html>
