<script src="../scripts/util.js"></script>
<script>
  const nota = { components: {} }
</script>

<link rel="import" href="nota-list.html">
<link rel="import" href="nota-editor.html">

<template>
  <div am-nota>
    <router-view :items="notae"></router-view>
    <nota-editor :item="nota"></nota-editor>
  </div>
</template>

<script>
  nota.components.Nota = Vue.extend({
    template: document.currentScript.ownerDocument.querySelector('template').content,
    
    props: [ 'data' ],

    events: {
      edit({ $id, title, content }) {
        
        console.log($id, title, content)
      },
    },
    
    computed: {
      notae() {
        return this.data.map(datum => {
          datum.contents = datum.contents.map(this.slugify)
          
          return datum
        })
      },
      
      nota() {
        return this.findBySlug( this.notae, this.$route.params.slug )
      },
    },
    
    methods: {
      slugify( item ) {
        if ( ! item.folder ) item.$slug = u.slugify( item.title )
        else item.contents = item.contents.map( this.slugify )
        
        return item
      },
      
      findBySlug( notae, $slug ) {
        let found = null
        
        notae.forEach(nota => {
          if ( ! nota.folder && nota.$slug === $slug ) found = nota
          else found = this.findBySlug( nota.contents )
        })
        
        return found
      },
    },
    
    components: {
        'nota-editor': nota.components.NotaEditor
      },
    
    name: 'nota',
  })
</script>